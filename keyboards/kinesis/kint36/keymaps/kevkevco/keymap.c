// Copyright 2022 Kevin Goldberg @kevkevco <hello@kevkev.co>
// SPDX-License-Identifier: GPL-2.0-or-later

#include "process_records.h"

// Keymaps
// clang-format off
const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {


/* QWERTY/Default Layer
,--------------------------------------------------------------.                                     ,--------------------------------------------------------------.
|ESC^ST|SWAPHD|  F2  |QWERTY|NUMSFT|FUNCTN|KEYPAD| NAV  | VIM  |                                     | CLEAR|MACROP|MACROR|MACROS| Mute | VolDn| VolUp|Keypad|PROGRM|
`--------------------------------------------------------------'                                     `--------------------------------------------------------------'
,------------------------------------------------------.                                                     ,------------------------------------------------------.
| ESC|`\~ |   1^!  |   2^@  |   3^#  |   4^$  |   5^%  |                                                     |   6^^  |  7^&   |  8^*   |  9^(   |   0^)  |  NAV    |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
| Tab|MEH |    Q   |    W   |    E   |    R   |    T   |                                                     |    Y   |   U    |   I    |   O    |   P    |Bksp/HYP |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
| LPINKY* | A/LCTL | S/LOPT | D/LGUI | F/LSHF |    G   |                                                     |    H   | J/RSHF | K/RGUI | L/ROPT | COLON* | RPINKY* |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
| :LSHFT  |    Z   |    X   |    C   |    V   |    B   |                                                     |    N   |   M    |  ,|<   |  .|>   |  /^?   | :RSHFT  |
`---------+--------+--------+--------+--------+--------'                                                     `--------+--------+--------+--------+--------+---------'
          | LKEYPD |   Fn   |  Left  |  Rght  |                                                                       |  Left  |  Down  |   Up***|  Rght**|
          `-----------------------------------'                                                                       `-----------------------------------'
	                                                   ,-----------------.                 ,-----------------.
	                                                   |SELWORD |Ent/COG*|                 | ****   | , / NAV|
	                                          ,--------+--------+--------|                 |--------+--------+--------.
	                                          |  Bksp  |  Del   |SPOT|Spc|                 |WINDOW* |  Enter |  SPACE |
	                                          | ^Del / |   /    |--------|                 |--------|    /   |  /RGUI |
	                                          |  LGUI  |  LSHFT | APPNAV |                 |  OSMeh |  Keypad|  //SFT |
	                                          `--------------------------'                 `--------------------------'
    Notes:

    * / indicates key-when-tapped/key-when-held
    * | indicates triggered with double tap
    * \ indicates triggered with triple tap
    * : indicates one shot
    * APPNAV opens application switcher for a renewable timeout. Press key again to move right; add shift to move left.
    * ^ Triggered With Shift
    * # Triggered With Command
    * SWAPHD = Tap and hold SwapHands for momentary swap, double tap for toggle on/off (currently configured to not swap top row of keyboard)
        * Swaps the hands of the keycode matrix, except the top small key row is left as is
    * CAPSWORD = Tap both shifts at same time for as long as their modtap length and CAPSWORD is activated
        * Manually exit CAPS word by pressing any modifier, pressing ESC keys, holding a Modtap to the mod activation point, and more
    * SELWORD = Selects current word, extends to next word on subsequent presses. Add shift and it selects line and adds next line with subsequent presses.
        * Tap ESC or right arrow to deselect and move cursor to end of seelction. Or, tap left arrow to move cursor to beginning of selection.
    * Dictation = Configured in MacOS: Double tapping any command key brings up dictation so you can dictate text
    * QMK compiles qmk code in terminal
        * Add command key and it additionally opens Teensy and puts board in command/program mode ready for flashing
        * Add shift key to only does the latter 
    * Fn is the Apple Native Function key
    * COG is short for Control+Option+Gui
    * Tab|MEH = hold for MEH application launching as explained below
    
    Tap Dance Details:
    * Window Tap Dance is configured for Rectangle Pro

    [CMAG] Comma on a single-tap, left angle bracket on a double-tap
    [SPOT] Command+Space (Spotlight) on a single-tap, space on a double-tap
    [ISPT] I key on a single-tap, Command+Space (Spotlight) on a double-tap
    [PDAG] Dot on a single-tap, right angle bracket on a double-tap, three dots on a triple tap
    [GVES] Esc on a single-tap, grave on a double-tap, tilde on a triple tap

    [WINDOW] 1:  One shot NAV layer with CTL+OPT active
             1h: NAV layer while holding with CTL+OPT active
             2:  Switch between windows of same app (CMD+`)
             2h: NAV layer while holding with CMD+CTL+OPT active
             3:  ______
             3h: Hide Window (CMD+H)
    [LPINKY] 1:  One shot SYMBOLS layer
             1h: NAV layer while holding
             2:  NAV layer toggle
             2h: Navigation layer while holding, with CTL+OPT active
             3:  Toggle LKEYPAD
             3h: End Running Program (CTL+C)
    [RPINKY] 1:  '
             1h: One shot SYMBOLS layer
             2:  Toggle NUMSHIFT layer
             2h: Caps Word
             3:  ______
             3h: ______
    [COLON]  1:  One shot SYMBOLS layer
             1h: RCTL while holding
             2:  Toggle NAV layer
             2h: NAV layer while holding
             3:  ______
             3h: ______
    [SLSH]   1:  /
             1h: Command+/ (Shortcut for commenting a line)
             2:  "// "
             2h: HTML style multiline comment
             3:  ?
             3h: ______
    [ENTR]   1:  Enter
             1h: RH Keypad layer while holding
             2:  Toggle RH Keypad layer
             2h: Toggle Numword
             3:  ______
             3h: ______

    MEH Application Launching: 
    
    OSMeh is used for quick switching between apps. One shot Meh modifier is used
    to trigger "complex modifications" by Karabiner to switch to various applications
    using a successive alphanumeric key (first letter of application name,
    or second/third/... letter if first letter is taken) as follows:

,--------------------------------------------------------------.                                     ,--------------------------------------------------------------.
|      |      |      |      |      |      |      |      |      |                                     |      |      |      |      |      |      |      |      |      |
`--------------------------------------------------------------'                                     `--------------------------------------------------------------'
,------------------------------------------------------.                                                     ,------------------------------------------------------.
|         | Teensy |        |        |        |        |                                                     |        |        |        |        |        |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         | QMK Web|        |Terminal| Chrome |Todoist |                                                     |SystPref|QuikNote|KrbnrEvt|Spotify |Photoshp|         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |PastePal| Safari | Drive  | Finder | Gmail  |                                                     |Spotlght|        |Desktop |LaunchPd|        |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |  Zoom  |        |Calendar| VSCode |Bitwardn|                                                     | Notion |Messages|        |        |        |         |
`---------+--------+--------+--------+--------+--------'                                                     `--------+--------+--------+--------+--------+---------'
          |        |        |        |        |                                                                       |        |        |        |        |
          `-----------------------------------'                                                                       `-----------------------------------'
	                                                   ,-----------------.                 ,-----------------.
	                                                   |        |        |                 |        |        |
	                                          ,--------+--------+--------|                 |--------+--------+--------.
	                                          |        |        |        |                 |        |        |        |
	                                          |        |        |--------|                 |--------|        |        |
	                                          |        |        |        |                 |        |        |        |
	                                          `--------------------------'                 `--------------------------'
    Notes:
    * PastePal shortcut is configured in its own application
    * Desktop, Quick Note, Launchpad (also in Karabiner) shortcut is confifured in MacOS system preferences
    
*/

[_QWERTY] = LAYOUT_pretty(
  ESC_STS, SH_TT,   KC_LEAD, QWERTY,  NUMSHFT, FUNCTN,  L_KEYPD, NAV,     VIM,     CLEAR,   DM_PLY1, DM_REC1, DM_RSTP, KC_MUTE, KC_VOLD, KC_VOLU, R_KEYPD, QMK,
  T_GVES,  KC_1,    KC_2,    KC_3,    KC_4,    KC_5,                                                          KC_6,    KC_7,    KC_8,    KC_9,    KC_0,    TG(_NAV),
  MEH_TAB, Q_HOLD,  W_HOLD,  KC_E,    R_HOLD,  T_HOLD,                                                        Y_HOLD,  KC_U,    T_ISPT,  KC_O,    KC_P,    BSP_HYP,
  T_LPNKY, A_CTL,   S_OPT,   D_GUI,   F_SFT,   KC_G,                                                          KC_H,    J_SFT,   K_GUI,   L_OPT,   T_COLON, T_RPNKY,  
  OS_LSFT, Z_HOLD,  X_HOLD,  C_HOLD,  V_HOLD,  B_HOLD,                                                        N_HOLD,  KC_M,    T_CMAG,  T_PDAG,  T_SLSH,  OS_RSFT, 
           L_KEYPD, KC_APFN, KC_LEFT, KC_RIGHT,                                                                        KC_LEFT, KC_DOWN, KC_UP,   KC_RGHT,
                                                        SELWORD, ENT_CAG,                   _______, COM_NAV,
                                                                 T_SPOT,                    T_WIND,
                                               BSP_GUI, DEL_SFT, APP_NAV,                   OS_MEH,  T_ENTR, SPC_GUI
),


/*  Symbols layer:
,--------------------------------------------------------------.                                     ,--------------------------------------------------------------.
|      |      |      |      |      |      |      |      |      |                                     |      |      |      |      |      |      |      |      |      |
`--------------------------------------------------------------'                                     `--------------------------------------------------------------'
,------------------------------------------------------.                                                     ,------------------------------------------------------.
|         |    !   |    @   |    #   |    $   |    %   |                                                     |    ^   |    &   |    *   |    (   |    )   |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |        |        |        |        |        |                                                     |        |        |        |        |        |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |        |        |        |        |        |                                                     |        |        |        |        |        |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |        |        |        |        |        |                                                     |        |        |        |        |        |         |
`---------+--------+--------+--------+--------+--------'                                                     `--------+--------+--------+--------+--------+---------'
          |        |        |        |        |                                                                       |        |        |        |        |
          `-----------------------------------'                                                                       `-----------------------------------'
	                                                   ,-----------------.                 ,-----------------.
	                                                   |        |        |                 |        |        |
	                                          ,--------+--------+--------|                 |--------+--------+--------.
	                                          |        |        |        |                 |        |        |        |
	                                          |        |        |--------|                 |--------|        |        |
	                                          |        |        |        |                 |        |        |        |
	                                          `--------------------------'                 `--------------------------'
*/


[_NUMSHIFT] = LAYOUT_pretty(
  _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______,
  _______, KC_EXLM, KC_AT,   KC_HASH, KC_DLR,  KC_PERC,                                                       KC_CIRC, KC_AMPR, KC_ASTR, KC_LPRN, KC_RPRN, _______,
  _______, _______, _______, _______, _______, _______,                                                       _______, _______, _______, _______, _______, _______,
  _______, _______, _______, _______, _______, _______,                                                       _______, _______, _______, _______, _______, _______,
  _______, _______, _______, _______, _______, _______,                                                       _______, _______, _______, _______, _______, _______,
           _______, _______, _______, _______,                                                                         _______, _______, _______, _______,
                                                        _______, _______,                   _______, _______,
                                                                 _______,                   _______,
                                               _______, _______, _______,                   _______, _______, _______
),


/*  
    Symbols Layer
    Mostly for coding, optimized currently for my use of Python
    Note: Best accessed through a oneshot layer key: LPINKY, RPINKY currently
,--------------------------------------------------------------.                                     ,--------------------------------------------------------------.
|      |      |      |      |      |      |      |      |      |                                     |      |      |      |      |      |      |      |      |      |
`--------------------------------------------------------------'                                     `--------------------------------------------------------------'
,------------------------------------------------------.                                                     ,------------------------------------------------------.
|         |        |        |        |        |        |                                                     |        |        |        |        |        |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |        |        |   #    |   |    |        |                                                     |        |        |        |        |        |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |   :    |   [    |   {    |   (    |   <    |                                                     |    >   |    )   |    }   |    ]   |    ;   |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |        |        |        |        |        |                                                     |        |        |        |        |    \   |         |
`---------+--------+--------+--------+--------+--------'                                                     `--------+--------+--------+--------+--------+---------'
          |        |        |        |        |                                                                       |        |        |        |        |
          `-----------------------------------'                                                                       `-----------------------------------'
	                                                   ,-----------------.                 ,-----------------.
	                                                   |   +    |        |                 |        |   `    |
	                                          ,--------+--------+--------|                 |--------+--------+--------.
	                                          |        |        |   *    |                 |        |        |        |
	                                          |   -    |   =    |--------|                 |--------|   "    |   _    |
	                                          |        |        |   /    |                 |        |        |        |
	                                          `--------------------------'                 `--------------------------'

*/


[_SYMBOLS] = LAYOUT_pretty(
  _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______,
  _______, _______, _______, _______, _______, _______,                                                       _______, _______, _______, _______, _______, _______,
  _______, _______, _______, KC_HASH, KC_PIPE, _______,                                                       _______, _______, _______, _______, _______, _______,
  _______, KC_COLN, KC_LBRC, KC_LCBR, KC_LPRN, KC_LABK,                                                       KC_RABK, KC_RPRN, KC_RCBR, KC_RBRC, KC_SCLN, _______,
  _______, _______, _______, _______, _______, _______,                                                       _______, _______, _______, _______, KC_BSLS, _______,
           _______, _______, _______, _______,                                                                         _______, _______, _______, _______,
                                                        KC_PLUS, _______,                   _______, KC_GRV,
                                                                 KC_ASTR,                   _______,
                                               KC_MINS, KC_EQL,  KC_SLSH,                   _______, KC_DQUO, KC_UNDS
),



/*  VIM - Holding spot for future implementation

,--------------------------------------------------------------.                                     ,--------------------------------------------------------------.
|      |      |      |      |      |      |      |      |      |                                     |      |      |      |      |      |      |      |      |      |
`--------------------------------------------------------------'                                     `--------------------------------------------------------------'
,------------------------------------------------------.                                                     ,------------------------------------------------------.
|         |        |        |        |        |        |                                                     |        |        |        |        |        |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |        |        |        |        |        |                                                     |        |        |        |        |        |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |        |        |        |        |        |                                                     |        |        |        |        |        |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |        |        |        |        |        |                                                     |        |        |        |        |        |         |
`---------+--------+--------+--------+--------+--------'                                                     `--------+--------+--------+--------+--------+---------'
          |        |        |  LEFT  | RIGHT  |                                                                       |   UP   |  DOWN  |        |        |
          `-----------------------------------'                                                                       `-----------------------------------'
	                                                   ,-----------------.                 ,-----------------.
	                                                   |        |        |                 |        |        |
	                                          ,--------+--------+--------|                 |--------+--------+--------.
	                                          |        |        |        |                 |        |        |        |
	                                          |        |        |--------|                 |--------|        |        |
	                                          |        |        |        |                 |        |        |        |
	                                          `--------------------------'                 `--------------------------'
*/

[_VIM] = LAYOUT_pretty(
  _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______,
  _______, _______, _______, _______, _______, _______,                                                       _______, _______, _______, _______, _______, _______,
  _______, _______, _______, _______, _______, _______,                                                       _______, _______, _______, _______, _______, _______,
  _______, _______, _______, _______, _______, _______,                                                       _______, _______, _______, _______, _______, _______,
  _______, _______, _______, _______, _______, _______,                                                       _______, _______, _______, _______, _______, _______,
           _______, _______, KC_LEFT, KC_RGHT,                                                                         KC_UP,   KC_DOWN, _______, _______,
                                                        _______, _______,                   _______, _______,
                                                                 _______,                   _______,
                                               _______, _______, _______,                   _______, _______, _______
),


/*
Navigation Layer
,--------------------------------------------------------------.                                     ,--------------------------------------------------------------.
| Sleep|      |      |      |      |      |      |      |      |                                     |      |      |      |      |      |      |      |      |      |
`--------------------------------------------------------------'                                     `--------------------------------------------------------------'
,------------------------------------------------------.                                                     ,------------------------------------------------------.
|         |        |        |        |        |        |                                                     |        |        |        |        |        |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |        |        |   Up   |        |        |                                                     |        |        |   Up   |        |        |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |        |  Left  |  Down  |  Right |        |                                                     |        |  Left  |  Down  |  Right |        |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |WheelUp |        |MouseUp |        |        |                                                     |        |        | MouseUp|        | WheelUp|         |
`---------+--------+--------+--------+--------+--------'                                                     `--------+--------+--------+--------+--------+---------'
          |WheelDn |MouseLft|MouseDn |MouseRgh|                                                                       |MouseLft| MouseDn|MouseRgh| WheelDn|
          `-----------------------------------'                                                                       `-----------------------------------'
	                                                   ,-----------------.                 ,-----------------.
	                                                   |        |        |                 |        |        |
	                                          ,--------+--------+--------|                 |--------+--------+--------.
	                                          | Mouse  | Mouse  |        |                 |        | Mouse  | Mouse  |
	                                          | Button | Button |--------|                 |--------| Button | Button |
	                                          |   1    |   2    | QWERTY |                 | QWERTY |   2    |   1    |
	                                          `--------------------------'                 `--------------------------'
    Note:
    * QWERTY deactivates the layer and returns to the main layout
*/

[_NAV] = LAYOUT_pretty(
  KC_SLEP, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______,
  _______, KC_ACL0, KC_ACL1, KC_ACL2, _______, _______,                                                       _______, _______, _______, _______, _______, _______,
  _______, _______, _______, KC_UP,   _______, _______,                                                       _______, _______, KC_UP,   _______, _______, _______,
  _______, _______, KC_LEFT, KC_DOWN, KC_RGHT, _______,                                                       _______, KC_LEFT, KC_DOWN, KC_RGHT, _______, _______,
  _______, KC_WH_U, _______, KC_MS_U, _______, _______,                                                       _______, _______, KC_MS_U, _______, KC_WH_U, _______,
           KC_WH_D, KC_MS_L, KC_MS_D, KC_MS_R,                                                                         KC_MS_L, KC_MS_D, KC_MS_R, KC_WH_D,
                                                        _______, _______,                   _______, _______,
                                                                 _______,                   _______,
                                               KC_BTN1, KC_BTN2, QWERTY,                    QWERTY,  KC_BTN2, KC_BTN1
),
 
/*  Keypad Layer
,--------------------------------------------------------------.                                     ,--------------------------------------------------------------.
|      |      |      |      |      |      |      |      |      |                                     |      |      |      |      |      |      |      |      |      |
`--------------------------------------------------------------'                                     `--------------------------------------------------------------'
,------------------------------------------------------.                                                     ,------------------------------------------------------.
|         |        |        |        |        |        |                                                     |        | QWERTY |  KP =  |  KP /  |  KP *  |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
| KPSWAP  |        |        |        |        |        |                                                     |        |   7    |   8    |   9    |  KP -  |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |        |        |        |        |        |                                                     |        |   4    |   5    |   6    |  KP +  |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |        |        |        |        |        |                                                     |   0    |   1    |   2    |   3    |  KP .  |         |
`---------+--------+--------+--------+--------+--------'                                                     `--------+--------+--------+--------+--------+---------'
          |        |        |        |        |                                                                       |        |        |        |        |
          `-----------------------------------'                                                                       `-----------------------------------'
	                                                   ,-----------------.                 ,-----------------.
	                                                   |        |        |                 |        |        |
	                                          ,--------+--------+--------|                 |--------+--------+--------.
	                                          |        |        |        |                 |        |++Enter |        |
	                                          |        |        |--------|                 |--------|   /    |        |
	                                          |        |        |        |                 |        | QWERTY |        |
	                                          `--------------------------'                 `--------------------------'
    Notes:
    * ++ is from QWERTY layer, and a quick exit from Keypad Layer is what the LT hold function effectively becomes
    * KPSWAP alternates between Keypad and LKeypad
*/

[_KEYPAD] = LAYOUT_pretty(
  _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______,
  KPSWAP,  _______, _______, _______, _______, _______,                                                       _______, QWERTY,  KC_PEQL, KC_PSLS, KC_PAST, _______,
  _______, _______, _______, _______, _______, _______,                                                       _______, KC_7,    KC_8,    KC_9,    KC_PMNS, _______,
  _______, _______, _______, _______, _______, _______,                                                       _______, KC_4,    KC_5,    KC_6,    KC_PPLS, _______,
  _______, _______, _______, _______, _______, _______,                                                       KC_0,    KC_1,    KC_2,    KC_3,    KC_PDOT, _______,
           _______, _______, _______, _______,                                                                         _______, _______, _______, _______,
                                                        _______, _______,                   _______, _______,
                                                                 _______,                   _______,
                                               _______, _______, _______,                   _______, _______, _______
),
/*  LH Keypad
,--------------------------------------------------------------.                                     ,--------------------------------------------------------------.
|      |      |      |      |      |      |      |      |      |                                     |      |      |      |      |      |      |      |      |      |
`--------------------------------------------------------------'                                     `--------------------------------------------------------------'
,------------------------------------------------------.                                                     ,------------------------------------------------------.
|         |        | QWERTY |  KP =  |  KP /  |  KP *  |                                                     |        |        |        |        |        |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
| KPSWAP  |        |   7    |   8    |   9    |  KP -  |                                                     |        |        |        |        |        |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |        |   4    |   5    |   6    |  KP +  |                                                     |        |        |        |        |        |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |    0   |   1    |   2    |   3    |  KP .  |                                                     |        |        |        |        |        |         |
`---------+--------+--------+--------+--------+--------'                                                     `--------+--------+--------+--------+--------+---------'
          |        |        |        |        |                                                                       |        |        |        |        |
          `-----------------------------------'                                                                       `-----------------------------------'
	                                                   ,-----------------.                 ,-----------------.
	                                                   |        |        |                 |        |        |
	                                          ,--------+--------+--------|                 |--------+--------+--------.
	                                          |        |        |        |                 |        |        |        |
	                                          |        |        |--------|                 |--------|        |        |
	                                          |        |        |        |                 |        |        |        |
	                                          `--------------------------'                 `--------------------------'
*/
[_LKEYPAD] = LAYOUT_pretty(
  _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______,
  KPSWAP,  _______, QWERTY,  KC_PEQL, KC_PSLS, KC_PAST,                                                       _______, _______, _______, _______, _______, _______,
  _______, _______, KC_7,    KC_8,    KC_9,    KC_PMNS,                                                       _______, _______, _______, _______, _______, _______,
  _______, _______, KC_4,    KC_5,    KC_6,    KC_PPLS,                                                       _______, _______, _______, _______, _______, _______,
  _______, KC_0,    KC_1,    KC_2,    KC_3,    KC_PDOT,                                                       _______, _______, _______, _______, _______, _______,
           _______, _______, _______, _______,                                                                         _______, _______, _______, _______,
                                                        _______, _______,                   _______, _______,
                                                                 _______,                   _______,
                                               _______, _______, _______,                   _______, _______, _______
),

 
/*  Function layer

,--------------------------------------------------------------.                                     ,--------------------------------------------------------------.
|      |      |      |      |      |      |      |      |      |                                     |      |      |      |      |      |      |      |      |      |
`--------------------------------------------------------------'                                     `--------------------------------------------------------------'
,------------------------------------------------------.                                                     ,------------------------------------------------------.
|         |   F1   |   F2   |   F3   |   F4   |   F5   |                                                     |   F6   |   F7   |   F8   |   F9   |   F10  | QWERTY  |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |        |        |        |        |        |                                                     |        |        |        |        |        |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |        |        |        |        |        |                                                     |        |        |        |        |        |         |
|---------+--------+--------+--------+--------+--------|                                                     |--------+--------+--------+--------+--------+---------|
|         |        |        |        |        |        |                                                     |        |        |        |        |        |         |
`---------+--------+--------+--------+--------+--------'                                                     `--------+--------+--------+--------+--------+---------'
          |        |        |        |        |                                                                       |        |        |        |        |
          `-----------------------------------'                                                                       `-----------------------------------'
	                                                   ,-----------------.                 ,-----------------.
	                                                   |        |        |                 |        |        |
	                                          ,--------+--------+--------|                 |--------+--------+--------.
	                                          |        |        |        |                 |        |        |        |
	                                          |        |        |--------|                 |--------|        |        |
	                                          |        |        |        |                 |        |        |        |
	                                          `--------------------------'                 `--------------------------'
*/

[_FUNCTION] = LAYOUT_pretty(
  _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______, _______,
  _______, KC_F1,   KC_F2,   KC_F3,   KC_F4,   KC_F5,                                                         KC_F6,   KC_F7,   KC_F8,   KC_F9,   KC_F10,  TO(_QWERTY),
  _______, _______, _______, _______, _______, _______,                                                       _______, _______, _______, _______, _______, _______,
  _______, _______, _______, _______, _______, _______,                                                       _______, _______, _______, _______, _______, _______,
  _______, _______, _______, _______, _______, _______,                                                       _______, _______, _______, _______, _______, _______,
           _______, _______, _______, _______,                                                                         _______, _______, _______, _______,
                                                        _______, _______,                   _______, _______,
                                                                 _______,                   _______,
                                               _______, _______, _______,                   _______, _______, _______
),

};

// End of Keymaps
// clang-format on

// clang-format off
/*
This is the Stapelberg matrix as published at
https://github.com/stapelberg/kinesis-firmware/blob/master/kb_kinesis/config.kspec
Along with the pins for each row and column
             PB0 PB1 PB2 PB3 PB4 PB5 PB6
             kx0 kx1 kx2 kx3 kx4 kx5 kx6
PD0 k0x Row: EQL TAB CAP LSH X2  --  --
PD1 k1x Row: 1   Q   A   Z   BQ  --  --
PD2 k2x Row: 2   W   S   X   INS END --
PD3 k3x Row: 3   E   D   C   LFT HOM BAK
PD4 k4x Row: 4   R   F   V   --  --  DEL
PD5 k5x Row: 5   T   G   B   RT  LAL LCT
PD6 k6x Row: 6   Y   H   N   UP  SPC PGD
PD7 k7x Row: 7   U   J   M   --  RET --
PC0 k8x Row: 8   I   K   COM DWN RCT PGU
PC1 k9x Row: 9   O   L   PER LBR --  RAL
PC2 kAx Row: 0   P   SEM SLA RBR --  --
PC3 kBx Row: MIN BSL APO RSH X1  --  --
PC4 kCx Row: ESC F3  F6  F9  F12 PAU --
PC5 kDx Row: F1  F4  F7  F10 PRT PRG --
PC6 kEx Row: F2  F5  F8  F11 SLK KEY --
*/


const keypos_t PROGMEM hand_swap_config[MATRIX_ROWS][MATRIX_COLS] = { \
    {{0, 11},  {1, 11},  {2, 11},  {3, 11}}, \
    {{0, 10},  {1, 10},  {2, 10},  {3, 10},  {4, 10}}, \
    {{0, 9},   {1, 9},   {2, 9},   {3, 9},   {4, 9},  {6, 6}}, \
    {{0, 8},   {1, 8},   {2, 8},   {3, 8},   {4, 8},  {6, 8},  {5, 6}}, \
    {{0, 7},   {1, 7},   {2, 7},   {3, 7}, {5, 7}}, \
    {{0, 6},   {1, 6},   {2, 6},   {3, 6},   {4, 5},  {6, 9},  {5, 8}}, \
    {{0, 5},   {1, 5},   {2, 5},   {3, 5},   {4, 5},  {6, 3},  {5, 2}}, \
    {{0, 4},   {1, 4},   {2, 4},   {3, 4},  {6, 4}}, \
    {{0, 3},   {1, 3},   {2, 3},   {3, 3},   {4, 3},  {6, 5},  {5, 3}}, \
    {{0, 2},   {1, 2},   {2, 2},   {3, 2},   {4, 2},  {5, 5}}, \
    {{0, 1},   {1, 1},   {2, 1},   {3, 1},   {4, 1}}, \
    {{0, 0},   {1, 0},   {2, 0},   {3, 0}}, \
    {{0, 12},  {1, 12},  {2, 12},  {3, 12},  {4, 12},  {5, 12}}, \
    {{0, 13},  {1, 13},  {2, 13},  {3, 13},  {4, 13},  {5, 13}}, \
    {{0, 14},  {1, 14},  {2, 14},  {3, 14},  {4, 14},  {5, 14}}  \
};

// clang-format on

// LED function variables initializations
bool     isRecording      = false;
bool     isRecordingLedOn = false;
uint16_t recording_timer  = 0;

bool     wave_active = false;
uint16_t wave_timer  = 0;
int      cycle       = 1;

bool     flash_active      = false;
uint16_t flash_timer       = 0;
int      flash_array[4][4] = {{0, 1, 2, 3}, {0, 0, 0, 0}};
int      led_state         = 0;

// Listener function => Triggered when you start recording a macro.
void dynamic_macro_record_start_user(void) {
    isRecording      = true;
    isRecordingLedOn = true;
    // timer_read() is a built-in function in qmk. => It read the current time
    recording_timer = timer_read();
}

// Listener function => Triggered when the macro recording is stopped.
void dynamic_macro_record_end_user(int8_t direction) {
    isRecording      = false;
    isRecordingLedOn = false;
    layer_on(0); // Dummy call to get layer_state_set_user to update
}

void led_flash(int led, bool state) {
    if (state == true) {
        flash_active        = true;
        flash_timer         = timer_read();
        flash_array[led][1] = 1;
    } else {
        flash_array[led][1] = 0;
        // Check to make sure there aren't other flash instances still active
        // for (int i = 0; i < 4; i++) {
        //     if (flash_array[i][1] == 1) {
        //         layer_on(0);
        //         return;
        // }
        flash_active = false;
        layer_on(0); // Dummy call to get layer_state_set_user to update
    }
}

// Turn on all LEDs to indicate CAPSWORD is active
void caps_word_set_user(bool active) {
    if (active) {
        layer_on(0); // Dummy call to get layer_state_set_user to be called for LED refresh
        // led_flash(0, true);
        // Turn on all LEDs when Caps Word activates.
        // writePin(LED_KEYPAD, 0);
        // writePin(LED_NUM_LOCK_PIN, 0);
        // writePin(LED_SCROLL_LOCK_PIN, 0);
        // writePin(LED_CAPS_LOCK_PIN, 0);
    } else {
        // led_flash(0, false);
        // Turn off all LEDs when Caps Word deactivates.
        writePin(LED_KEYPAD, 1);
        writePin(LED_NUM_LOCK_PIN, 1);
        writePin(LED_SCROLL_LOCK_PIN, 1);
        writePin(LED_CAPS_LOCK_PIN, 1);
        layer_on(0); // Dummy call to get layer_state_set_user to be called for LED refresh
    }
}

void led_wave(bool state) {
    if (state == true) {
        writePin(LED_KEYPAD, 1);
        writePin(LED_NUM_LOCK_PIN, 1);
        writePin(LED_SCROLL_LOCK_PIN, 1);
        writePin(LED_CAPS_LOCK_PIN, 1);
        wave_active = true;
        wave_timer  = timer_read();
    } else {
        wave_active = false;
        layer_on(0); // Dummy call to get layer_state_set_user to be called for LED refresh
        cycle = 1;   // Reset the wave to the beginning
    }
}

// Changes the LEDs on Keyboard to indicate active layers
// Callback functions that get called every time the layer changes
layer_state_t layer_state_set_user(layer_state_t state) {
    if (!isRecording) { // Let Macro LED settings override standard ones

        // When _SYMBOLS Layer is activated, LED wave is activated
        if (IS_LAYER_ON_STATE(state, _SYMBOLS)) {
            led_wave(true);
        } else if (caps_word_get()) { // Turn on all LEDs when Caps Word is active.

            writePin(LED_KEYPAD, 0);
            writePin(LED_NUM_LOCK_PIN, 0);
            writePin(LED_SCROLL_LOCK_PIN, 0);
            writePin(LED_CAPS_LOCK_PIN, 0);
            return state;
        } else { // Basic LED settings to indicate active layers
            // LED Labelled: "A"
            writePin(LED_CAPS_LOCK_PIN, !layer_state_cmp(state, _VIM));
            // LED Labelled: "1"
            writePin(LED_NUM_LOCK_PIN, !layer_state_cmp(state, _NUMSHIFT));
            // LED Labelled: "â†“"
            writePin(LED_SCROLL_LOCK_PIN, !layer_state_cmp(state, _NAV));
            // LED Labelled: Keypad Symbol
            writePin(LED_KEYPAD, !layer_state_cmp(state, _KEYPAD));
        }
    }
    return state;
}

bool led_update_user(led_t led_state) {
    // Disable led_update_kb() so that layer indication code doesn't get overridden.
    return false;
}

LEADER_EXTERNS(); // For leader key

void matrix_scan_user(void) {
    LEADER_DICTIONARY() {
        leading = false;
        leader_end();

        for (int i = 0; i < leader_sequence_size; i++) {
            register_code16(leader_sequence[i]);
        }

        for (int j = leader_sequence_size - 1; j >= 0; j--) {
            unregister_code16(leader_sequence[j]);
        }
    }

    // CMD_TAB Timer Timed Out
    if (is_cmd_tab_active) {
        if (timer_elapsed(cmd_tab_timer) > 800) {
            unregister_code(KC_LGUI);
            is_cmd_tab_active = false;
        }
    }

    if (flash_active) {
        if (timer_elapsed(flash_timer) > 100) {
            for (int i = 0; i < 4; i++) {
                if (flash_array[i][1] == 1) {
                    switch (i) {
                        case 0:
                            // LED Labelled: "A"
                            // led_state = readPin(LED_CAPS_LOCK_PIN); // OR, function could set an arbitrary on/off starting point and update it each flash.
                            // led_state = (led_state + 1) % 2; // Invert led_state
                            // writePin(LED_CAPS_LOCK_PIN, led_state);
                            // togglePin(LED_CAPS_LOCK_PIN);
                            break;
                        case 1:
                            // LED Labelled: "1"
                            // led_state = readPin(LED_NUM_LOCK_PIN);
                            // led_state = (led_state + 1) % 2; // Invert led_state
                            // writePin(LED_NUM_LOCK_PIN, led_state);
                            togglePin(LED_NUM_LOCK_PIN);
                            break;
                        case 2:
                            // LED Labelled: "â†“"
                            // led_state = readPin(LED_SCROLL_LOCK_PIN);
                            // led_state = (led_state + 1) % 2; // Invert led_state
                            // writePin(LED_SCROLL_LOCK_PIN, led_state);
                            togglePin(LED_SCROLL_LOCK_PIN);
                            break;
                        case 3:
                            // LED Labelled: Keypad Symbol
                            // led_state = readPin(LED_KEYPAD);
                            // led_state = (led_state + 1) % 2; // Invert led_state
                            // writePin(LED_KEYPAD, led_state);
                            togglePin(LED_KEYPAD);
                            break;
                    }
                }
            }

            flash_timer = timer_read();
        }
    }

    // LED Wave
    if (wave_active && timer_elapsed(wave_timer) > 100) {
        if (IS_LAYER_ON(_SYMBOLS)) {
            switch (cycle) {
                case 1:
                    writePin(LED_CAPS_LOCK_PIN, 0);
                    // SEND_STRING("1");
                    break;
                case 2:
                    writePin(LED_NUM_LOCK_PIN, 0);
                    // SEND_STRING("2");
                    break;
                case 3:
                    writePin(LED_CAPS_LOCK_PIN, 1);
                    // SEND_STRING("3");
                    break;
                case 4:
                    writePin(LED_SCROLL_LOCK_PIN, 0);
                    // SEND_STRING("4");
                    break;
                case 5:
                    writePin(LED_NUM_LOCK_PIN, 1);
                    // SEND_STRING("5");
                    break;
                case 6:
                    writePin(LED_KEYPAD, 0);
                    // SEND_STRING("6");
                    break;
                case 7:
                    writePin(LED_SCROLL_LOCK_PIN, 1);
                    // SEND_STRING("7");
                    break;
                case 8:
                    writePin(LED_KEYPAD, 1);
                    // SEND_STRING("8");
                    cycle = 0; // Code below switch block will increment this up to 1
                    break;
            }
            wave_timer = timer_read();
            cycle++;
        } else {
            led_wave(false);
        }
    }

    // Dynamic Macro Recording LED flash
    if (isRecording) {
        // timer_elapsed() is a built-in function in qmk => it calculates in ms the time elapsed with timer_read()
        if (timer_elapsed(recording_timer) > 333) {
            isRecordingLedOn = !isRecordingLedOn;
            recording_timer  = timer_read();
            writePin(LED_KEYPAD, 1);
            writePin(LED_NUM_LOCK_PIN, 1);
            writePin(LED_SCROLL_LOCK_PIN, 1);
            writePin(LED_CAPS_LOCK_PIN, 1);
        }
        if (isRecordingLedOn) {
            writePin(LED_KEYPAD, 0);
            writePin(LED_NUM_LOCK_PIN, 0);
            writePin(LED_SCROLL_LOCK_PIN, 0);
            writePin(LED_CAPS_LOCK_PIN, 0);
        }
    }
}

bool caps_word_press_user(uint16_t keycode) {
    switch (keycode) {
        // Keycodes that continue Caps Word, with shift applied.
        case KC_A ... KC_Z:
            add_weak_mods(MOD_BIT(KC_LSFT)); // Apply shift to the next key.
            print("\nkeycodes that continue CW WITH shifting");
            return true;

        // Keycodes that continue Caps Word, without shifting.
        case SFT_T(KC_DEL):
        case GUI_T(KC_BSPC):
        case KC_1 ... KC_0:
        case KC_BSPC:
        case KC_MINS:
            print("\nkeycodes that continue CW without shifting");
            return true;

        case KC_UNDS:
            print("\nunds");
            return true;

        // case ESC_STS:
        // case KC_ESC:
        default:
            print("\nkeycodes that end CW");
            return false; // Deactivate Caps Word.
    }
}
